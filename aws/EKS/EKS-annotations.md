# EKS annotations

- [LBC Annotations](https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.14/guide/ingress/annotations/)
- [Route application and HTTP traffic with Application Load Balancers](https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html)

Object                  | Required | annotations & tags                                                         | Note                                                                                                                                   | Ref
------------------------|----------|----------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------
Node SG tag (one of SG) | V        | `kubernetes.io/cluster/<my-cluster>: {shared OR owned}`                    | SG 是否為 cluster 專屬                                                                                                                 |
Subnet tag              | better   | `kubernetes.io/cluster/<my-cluster>: {shared OR owned}`                    | Subnet 是否為 cluster 專屬                                                                                                             |
Subnet tag              | V        | `kubernetes.io/role/internal-elb: "1"` OR `kubernetes.io/role/elb: "1"`    | LBC 才知道要把 LB 放到哪; 或 *Ingress/Service.LoadBalancer 的 Annotation要聲明 SubnetID(不推)*                                         |
Ingress annotation      | V        | `kubernetes.io/ingress.class: alb`                                         | LBC 用來操作 LB                                                                                                                        |
Ingress annotation      | -        | `alb.ingress.kubernetes.io/ip-address-type: dualstack`                     | 若要使用 IPv6                                                                                                                          |
Ingress annotation      | -        | `alb.ingress.kubernetes.io/tags: k1=v1, Env=dev, ...`                      | 可自訂 LB labels                                                                                                                       |
Ingress annotation      | V        | `alb.ingress.kubernetes.io/target-type: ip` (if legacy use `instance`)     | ALB 直接 forward 到 Pod ip                                                                                                             |
Ingress annotation      | V        | `alb.ingress.kubernetes.io/scheme: internet-facing` OR `internal`          | LBC 建立 ALB 判斷 internet/internal                                                                                                    |
Ingress annotation      | -        | `alb.ingress.kubernetes.io/group.name: {GroupName}`                        | Ingress 共用 ALB 不同團隊共用, 但分開管 Ingress                                                                                        |
Ingress annotation      | -        | `alb.ingress.kubernetes.io/group.order: {1~1000}`                          | Ingress 共用 ALB 彼此的 priority, 避免戶蓋                                                                                             |
Ingress annotation      | -        | `alb.ingress.kubernetes.io/certificate-arn: {ACM_Cert_ARN}`                | ALB https 使用的 ACM certificate arn                                                                                                   |
Ingress annotation      | -        | `alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'`  | ALB 的 listeners                                                                                                                       |
Ingress annotation      | -        | `alb.ingress.kubernetes.io/security-groups: sg-xxxx, nameOfSg1, nameOfSg2` | Default: ingress 建立的 ALB 會使用新建立的 SG, 並且 cluster Nodes 的 SG 也會被允許來自此 ALB SG 的訪問; 但若自訂, 則需自行控管 SgRules | https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.14/guide/ingress/annotations/#security-groups
Ingress annotation      | -        | `alb.ingress.kubernetes.io/manage-backend-security-group-rules: true`      | -  LBC 自動幫忙管理 backend Node/Pod SG rules                                                                                          |
Ingress annotation      | -        | `service.beta.kubernetes.io/aws-load-balancer-security-groups: xx`         |                                                                                                                                        | https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.16/deploy/security_groups/
Ingress annotation      | -        | `alb.ingress.kubernetes.io/healthcheck-path: /health`                      | (??) Ingress 底下的 rules, 共用的 health check endpoint (但不知道與 Ingress Group 會如何交互影響)                                      | https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.14/guide/ingress/annotations/#healthcheck-path
